<!DOCTYPE html>
<html>
<head>
  <title>UK Days Out Map</title>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=0.5"/>

  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css"/>

  <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&family=Inter:wght@400;700&display=swap" rel="stylesheet"/>

  <style>
    #map{height:100vh}
    :root.light-theme{
      --bg:#1a1a1a;--fg:#f4f4f4;--accent:#157a18;--soft-accent:#8cfa8f;
      --card-bg:#262626;--button-bg:#111;--button-border:#157a18
    }
    :root{
      --bg:#f6f6db;--fg:#222;--accent:#157a18;--soft-accent:#8cfa8f;
      --card-bg:#f6f6db;--button-bg:#f0e6e6;--button-border:#157a18
    }
    *{box-sizing:border-box}
    body{
      margin:0;background:var(--bg);color:var(--fg);
      font-family:'Inter',sans-serif;line-height:0.8;
      transition:background-color .4s,color .4s
    }
    header{
      display:flex;justify-content:space-between;align-items:center;
      padding:1rem 2rem;background:var(--card-bg);
      border-bottom:1px solid #444;position:sticky;top:0;z-index:999
    }
    .logo{
      font-family:'Press Start 2P',monospace;
      font-size:1rem;color:var(--accent)
    }
    nav a{
      color:var(--fg);text-decoration:none;margin-left:2rem;
      font-weight:bold;transition:color .3s
    }
    nav a:hover{color:var(--accent)}
    .toggle{
      background:var(--button-bg);border:2px solid var(--button-border);
      color:var(--accent);padding:.3rem .6rem;
      font-family:'Press Start 2P',monospace;font-size:.7rem;
      cursor:pointer;transition:all .3s;margin-left:2rem;
      box-shadow:2px 2px 0 var(--accent)
    }
    .toggle:hover{background:var(--accent);color:var(--bg)}
  </style>
</head>

<body>
<header>
  <div class="logo">UK Days Out Map</div>
  <nav>
    <a href="index.html">WebsiteHome</a>
    <a href="about.html">About</a>
    <button class="toggle" onclick="toggleTheme()">Light/Dark</button>
  </nav>
</header>
  
<div id="searchBox"
  style="
    position:absolute;
    top:70px;
    left:60px;   /* moved right from zoom buttons */
    z-index:999;
    width:260px;
    font-size:14px;
  "
>
  <input id="searchInput"
    type="text"
    placeholder="Search attractions"
    autocomplete="off"
    style="
      width:100%;
      padding:8px 10px;
      border:1px solid #444;
      border-radius:6px 6px 0 0;
      font-size:14px;
    "
  >
  <div id="suggest"
    style="
      background:#fff;
      border:1px solid #444;
      border-top:none;
      display:none;
      max-height:260px;
      overflow:auto;
      border-radius:0 0 6px 6px;
      box-shadow:0 4px 10px rgba(0,0,0,.3);
    "
  ></div>
</div>

<div id="map"></div>

<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>

<script>
const map=L.map('map').setView([54.5,-3.5],6);

L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',{
  attribution:'&copy; OpenStreetMap contributors'
}).addTo(map);

// sample marker
L.marker([53.36923,-1.49044]).addTo(map)
  .bindPopup('"Dead Centre" of Sheffield');

function toggleTheme(){
  document.documentElement.classList.toggle('light-theme');
}

const input = document.getElementById("searchInput");
const sug   = document.getElementById("suggest");

input.onkeydown = e => {
  if(e.key === "Enter"){
    e.preventDefault();
    pickFirst();
  }
};

function pickFirst(){
  const t = input.value.trim().toLowerCase();
  if(!t) return;
  const out = attractions.filter(x => x.name.toLowerCase().includes(t));
  if(out.length > 0) gotoAttraction(out[0]);
  sug.style.display = "none";
}

input.oninput = () => {
  const t = input.value.trim().toLowerCase();
  if(!t){
    sug.style.display = "none";
    return;
  }
  const out = attractions.filter(x => x.name.toLowerCase().includes(t));
  showSuggestions(out.slice(0,10));
};

function showSuggestions(list){
  if(list.length === 0){
    sug.style.display = "none";
    return;
  }
  sug.innerHTML = "";
  list.forEach(a=>{
    const d = document.createElement("div");
    d.textContent = a.name;
    d.style.padding = "8px";
    d.style.cursor  = "pointer";
    d.onmouseover   = () => d.style.background = "#eee";
    d.onmouseout    = () => d.style.background = "#fff";
    d.onclick       = () => {
      sug.style.display = "none";
      gotoAttraction(a);
    };
    sug.appendChild(d);
  });
  sug.style.display = "block";
}

function gotoAttraction(a){
  map.flyTo([a.lat,a.lng], 12);
  markers[a.id].openPopup();
  showDetails(a);
}
  
function getDistanceKm(a1,o1,a2,o2){
  const R=6371;
  const r=d=>d*Math.PI/180;
  const dA=r(a2-a1);
  const dO=r(o2-o1);
  const x=Math.sin(dA/2)**2+
    Math.cos(r(a1))*Math.cos(r(a2))*Math.sin(dO/2)**2;
  const c=2*Math.atan2(Math.sqrt(x),Math.sqrt(1-x));
  return R*c;
}

function findNearestStation(a,stations){
  let out=null;
  let best=Infinity;
  stations.forEach(s=>{
    const d=getDistanceKm(a.lat,a.lng,s.lat,s.long);
    if(d<best){
      best=d;
      out={...s,distanceKm:d};
    }
  });
  return out;
}

Promise.all([
  fetch('attractions.json').then(r=>r.json()),
  fetch('stations.json').then(r=>r.json())
]).then(([attractions,stations])=>{
  attractions.forEach(a=>{
    const ns=findNearestStation(a,stations);
    const html=
      `<h3>${a.name}</h3>
      <p><b>Type:</b> ${a.type.join(', ')}</p>
      <p><b>Memberships:</b> ${a.memberships.join(', ')}</p>
      <p><b>Nearest station:</b> ${ns.stationName} (${ns.distanceKm.toFixed(1)} km)</p>`;
      //<p><b>Go by train:</b>     ${}
     // <button onclick=href="https://www.google.com/maps/place/Amberley+Museum/@50.898011,-0.5421111,17z/data=!3m1!4b1!4m6!3m5!1s0x4875baad9d53f05b:0x6a1de906749895d2!8m2!3d50.898011!4d-0.5395362!16zL20vMDExeHE1?entry=ttu&g_ep=EgoyMDI1MTAyNy4wIKXMDSoASAFQAw%3D%3D">Light/Dark</button>
    L.marker([a.lat,a.lng]).addTo(map).bindPopup(html);
  });
});
</script>
</body>
</html>
